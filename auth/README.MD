# Авторизация

> Изучить возможные способы авторизации и аутентификации в клиент-серверном приложении — передача данных через cookie, через тело
> запроса, получение сессионных ключей.

Реализовал авторизацию с передачей данных:

- через cookie: [клиентская часть](https://github.com/vkosinov/learn/blob/main/auth/cookie/app), [темная сторона](https://github.com/vkosinov/learn/blob/main/auth/cookie/api)

- через заголовок: [frontend](https://github.com/vkosinov/learn/blob/main/auth/header/app), [backend](https://github.com/vkosinov/learn/blob/main//auth//header/api)

- сессии: [frontend](https://github.com/vkosinov/learn/blob/main/auth/session/app), [backend](https://github.com/vkosinov/learn/blob/main/auth/session/api)

> Отдельно изучить сценарии регистрации нового пользователя,
> хранения авторизационных данных в БД, восстановления пароля.

В качестве БД использовал mongodb, для примера и тренировки реализовал методы: для регистрации пользователей, для получения списка пользователей, восстановление/смена пароля (сгенерированная ссылка не отправляется через email, формируется под формой), страницу с комментариями (использовалась для тренировки с XSS), удаление пользователей доступное только пользователю роли admin.

~~Для отображения каждого из примеров использую [статичные html файлы](https://github.com/vkosinov/learn/blob/main/src/public), с разными для каждого сценария js файлами.~~

Для большего контроля над сервером и тренировки настройки CSP использовал Node.js c express

Для серверной части использовал Node.js c express (да будет благословен тот кто пишет без express)

> Какие возможные векторы атаки на каждый вариант передачи данных? Для демонстрации сценариев атаки и способов защиты собрать небольшой проект с клиентской и серверной частями, реализующими разные сценарии авторизации и показать, как будет работать перехват данных пользователя, как ими может воспользоваться злоумышленник.

### 1. Авторизация через cookie

- XSS

  - если cookie без флага httpOnly и на сайте есть _XSS_ уязвимость файл куки может быть доступен из js, из куки может быть считан токен который в последующем может быть использован

    > В приложении сымитировал XSS уязвимость на странице комментариев (данные сервера выводил на страницу без стерилизации и убрал флаг httpOnly)

  - **Меры для защиты:** Вернул флаг httpOnly, добавил стерилизацию данных, настроил CSP на сервере

- CSRF

  - если есть XSS уязвимости, если нет флага sameSite для cookie

  - **Меры для защиты:** Установил для куки sameSite: 'strict', добавил в axios instance кастомный заголовок X-CSRF-PROTECTION и проверяю его наличие на сервере

- Clickjacking
  - добавил 'frame-ancestors': 'none' в CSP и X-Frame-Options

### 2. Через заголовок

- XSS

  - Токен после авторизации хранится в localstorage поэтому доступен для XSS атак

  - **Меры для защиты:** добавил стерилизацию данных перед выводов в  документ, настроил CSP на сервере.

- Clickjacking

  - добавил 'frame-ancestors': 'none' в CSP и X-Frame-Options

### 3. Сессии

- XSS

  - если cookie без флага httpOnly и на сайте есть _XSS_ уязвимость файл куки может быть доступен из js

  - **Меры для защиты:** Флаг httpOnly, добавил стерилизацию данных, настроил CSP на сервере

- CSRF

  - Если нет флага sameSite для cookie есть активная сессия или сессия не корректно завершается в браузером

  - **Меры для защиты:** Установил для куки sameSite: 'strict'
